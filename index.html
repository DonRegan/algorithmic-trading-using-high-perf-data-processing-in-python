<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>High-Performance Data Processing in Python</title>

    <meta name="description" content="Talk demonstrating how to massively optimise data processing and numerical computation in Python">
    <meta name="author" content="Donald Whyte">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css" id="theme">
    <!--<link rel="stylesheet" href="css/print/pdf.css">-->
    <link rel="stylesheet" href="css/custom.css">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
    link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi )
        ? 'css/print/pdf.css'
        : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">
      <div class="slides">
        <section data-markdown="contents.md"
                 data-separator="^\[NEXT SECTION\]"
                 data-separator-vertical="^\[NEXT\]"
                 data-separator-notes="^_note_">
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <!-- Custom JS libraries -->
    <script src="lib/js/jquery-3.2.1.min.js"></script>
    <!-- TOOD: download locally -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>

    <!-- Reveal initialisation -->
    <script>
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'none', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true },
          {
            src: 'plugin/external/external.js',
            condition: function() {
              return !!document.querySelector('[data-external]');
            }
          }
        ]
      });

      // FUNCTIONS
      function load_chart_event() {
        $("text:contains('Highcharts.com')").remove();
      }

      function create_line_chart(container_id,
                                 series,
                                 x_axis_label,
                                 y_axis_label,
                                 label_colour)
      {
        return Highcharts.chart(container_id, {
          chart: {
            events: { load: load_chart_event },
            marginTop: 32,
            marginBottom: 64,
            borderColor: '#4572A7',
            backgroundColor: '#222',
            borderWidth: 3,
            borderColor: '#444',
            plotShadow: true
          },
          title: { text: ''},
          xAxis: {
            lineWidth: 1,
            lineColor: '#CCCCCC',
            tickPixelInterval: 80,
            tickLength: 5,
            tickWidth: 1,
            tickColor: '#FFFFFF',
            tickPosition: 'outside', // 'inside' or 'outside'
            gridLineWidth: 1,
            gridLineColor: '#444444',
            showFirstLabel: true,
            showLastLabel: false,
            startOnTick: true,
            endOnTick: true,
            allowDecimals: false,
            title: {
              text: x_axis_label,
              style: {
                'color': 'white',
                'font-size': '22px'
              }
            },
            labels: {
              align: 'center',
              style: {
                'color': 'white',
                'font-size': '18px'
              }
            }
          },
          yAxis: {
            lineWidth: 1,
            lineColor: '#CCCCCC',
            tickPixelInterval: 50,
            tickLength: 5,
            tickWidth: 1,
            tickColor: '#FFFFFF',
            tickPosition: 'inside',
            gridLineWidth: 1,
            gridLineColor: '#444444',
            alternateGridColor: 'rgba(0, 0, 0, .2)',
            minorTickInterval: null,
            minorTickLength: 2,
            minorTickWidth: 0,
            minorTickColor: '#cccccc',
            minorTickPosition: 'outside',
            minorGridLineWidth: 1,
            minorGridLineColor: '#333333',
            minRange: 1,
            showFirstLabel: false,
            showLastLabel: true,
            title: {
              text: y_axis_label,
              style: {
                'color': 'white',
                'font-size': '22px'
              }
            },
            labels: {
              align: 'right',
              style: {
                'color': 'white',
                'font-size': '20px'
              }
            },
            maxZoom: 1
          },
          legend: {
            enabled: false,
            floating: true,
            layout: 'vertical',
            borderWidth: 1,
            borderColor: '#444444',
            borderCornerRadius: 5,
            shadow: true,
            backgroundColor: 'rgba(32, 32, 32, .75)',
            align: 'left',
            x: 80,
            verticalAlign: 'top',
            y: 30,
            itemStyle: {
              color: '#CCCCCC',
              listStyle: 'none',
              listStyleImage: 'none'
            },
            itemHiddenStyle: {
              color: '#444444'
            },
            itemHoverStyle: {
              color: 'white'
            }
          },
          tooltip: { enabled: false },
          plotOptions: {
            series: {
                lineWidth: 5,
                shadow: true,
                marker: {
                    enabled: false,
                    symbol: 'circle'
                }
            }
          },
          series: series
        });
      }

      function create_bar_chart(container_id,
                                series,
                                categories,
                                y_axis_label,
                                y_axis_label_formatter,
                                theme,
                                show_legend)
      {
        const label_colour = {
          'light': 'white',
          'dark': 'black'
        }[theme];

        if (show_legend) {
          var legend = {
            x: 0,
            itemStyle: {
              fontSize: 22,
              color: label_colour
            },
            symbolHeight: 18,
          };
          var chart_margin_bottom = 100;
          var axis_label_size = '22px';
        } else {
          var legend = {enabled: false};
          var chart_margin_bottom = 32;
          var axis_label_size = '28px';
        }

        return Highcharts.chart(container_id, {
          chart: {
            type: 'column',
            backgroundColor: 'rgba(0, 0, 0, 0)',
            events: { load: load_chart_event },
            marginTop: 64,
            marginBottom: chart_margin_bottom
          },
          title: { text: '' },
          xAxis: {
            categories: categories,
            crosshair: true,
            labels: {
              style: {
                color: label_colour,
                'font-weight': 'strong',
                'font-size': '18px'
              }
            }
          },
          yAxis: {
            min: 0,
            title: {
              text: y_axis_label,
              style: {
                color: label_colour,
                'font-weight': 'strong',
                'font-size': axis_label_size
              }
            },
            labels: {
              formatter: y_axis_label_formatter,
              style: {
                color: label_colour,
                'font-weight': 'strong',
                'font-size': '18px'
              }
            }
          },
          legend: legend,
          tooltip: { enabled: false },
          exporting: { enabled: false },
          plotOptions: {
            column: {
              pointPadding: 0.2,
              borderWidth: 0
            }
          },
          series: series
        });
      }

      Reveal.addEventListener('ready', function(event) {
        create_bar_chart(
          'python-vs-c',
          [
            {
              name: 'CPython 3.7',
              color: '#44AA44',
              data: [ 3.52, 15.57, 21.71, 79.61, 92.78, 61.81 ]
            },
            {
              name: 'C (gcc)',
              color: '#FF0000',
              data: [ 1.75, 1.5, 1.75, 5.07, 2.54, 1.32 ]
            }
          ],
          [
            'pidigits',
            'regex-redux',
            'r-complement',
            'k-nucleotide',
            'binary-trees',
            'fasta'
          ],
          'execution time (secs)',
          function () { return this.value + 's'; },
          'light',
          false);

        create_bar_chart(
          'deep-learning-revenue',
          [
            {
              name: 'Global Revenue',
              data: [2000, 3500, 8000, 10500, 18000, 25000, 38000, 52000, 70500, 9000]
            }
          ],
          [2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025],
          'Revenue ($ millions)',
          function () { return '$' + this.value; },
          'light',
          false);

        const timing_sections = [
          'station_ranges',
          'fill_forward',
          'rolling_average',
          'rolling_std',
          'find_outliers'
        ];
        const pure_python_times = {
            name: 'Pure Python',
            color: 'green',
            data: [60, 60, 60, 60, 60]
        };
        const numpy_times = {
          name: 'NumPy',
          color: 'red',
          data: [6, 6, 6, 6, 6]
        };
        const vectorised_times = {
          name: 'NumPy + Vectorised',
          color: 'blue',
          data: [6, 6, 6, 6, 6]
        };
        const numba_times = {
          name: 'NumPy + Vectorised + Numba',
          color: 'black',
          data: [6, 6, 6, 6, 6]
        };
        const parallelised_times = {
          name: 'Parallelised',
          color: 'green',
          data: [6, 6, 6, 6, 6]
        };
        const parallelised_times_memmap = {
          name: 'Parallelised (memmap)',
          color: 'red',
          data: [6, 6, 6, 6, 6]
        };
        const time_axis_label = 'execution time (mins)';
        const time_axis_formatter = function () { return this.value + 'm'; };

        create_bar_chart(
          'purepython-times', [pure_python_times],
          timing_sections, time_axis_label, time_axis_formatter, 'dark', true);
        create_bar_chart(
          'numpy-times', [pure_python_times, numpy_times],
          timing_sections, time_axis_label, time_axis_formatter, 'dark', true);
        create_bar_chart(
          'vectorised-times', [numpy_times, vectorised_times],
          timing_sections, time_axis_label, time_axis_formatter, 'dark', true);
        create_bar_chart(
          'numba-times', [numpy_times, vectorised_times, numba_times],
          timing_sections, time_axis_label, time_axis_formatter, 'dark', true);
        create_bar_chart(
          'parallelised-times', [numba_times, parallelised_times],
          timing_sections, time_axis_label, time_axis_formatter, 'dark', true);
        create_bar_chart(
          'parallelised-times-memmap',
          [numba_times, parallelised_times, parallelised_times_memmap],
          timing_sections, time_axis_label, time_axis_formatter, 'dark', true);

        create_bar_chart(
          'basic-numpy-benchmark-times',
          [
            {
              name: 'timings',
              color: 'blue',
              data: [1.0996, 0.8266, 3.4815, 0.0305]
            }
          ],
          ['python (indexing)', 'python (zip)', 'numpy (loop)', 'numpy (built-in)'],
          'execution time (secs)',
          function () { return this.value + 's'; },
          'dark',
          false);
        create_bar_chart(
          'basic-numpy-benchmark-speedup',
          [
            {
              name: 'speedup',
              color: 'red',
              data: [
                1.0996 / 1.0996,
                1.0996 / 0.8266,
                1.0996 / 3.4815,
                1.0996 / 0.0305
              ]
            }
          ],
          ['python (indexing)', 'python (zip)', 'numpy (loop)', 'numpy (built-in)'],
          'speedup factor',
          function () { return this.value; },
          'dark',
          false);

        create_bar_chart(
          'vectorise-benchmark',
          [{name: 'timings', color: 'blue', data: [0.023458, 0.015989]}],
          ['non-vectorised', 'vectorised'],
          'execution time (secs)',
          function () { return this.value + 's'; },
          'dark',
          false);

        const numba_sections = [
            'python',
            'numba (inferred types)',
            'numba (explicit types)',
            'pure numpy'
        ];
        const numba_benchmark_times = [1.6818, 0.0674, 0.0084, 0.0058];
        const numba_benchmark_speedups = [
            1.6818 / 1.6818, 1.6818 / 0.0674, 1.6818 / 0.0084, 1.6818 / 0.0058
        ];

        create_bar_chart(
          'numba-benchmark-times1',
          [{name: 'timings', color: 'blue', data: numba_benchmark_times.slice(0, 2)}],
          numba_sections.slice(0, 2),
          'execution time (secs)',
          function () { return this.value + 's'; },
          'dark',
          false);
        create_bar_chart(
          'numba-benchmark-speedup1',
          [{name: 'speedup', color: 'red', data: numba_benchmark_speedups.slice(0, 2)}],
          numba_sections.slice(0, 2),
          'speedup factor',
          function () { return this.value; },
          'dark',
          false);
        create_bar_chart(
          'numba-benchmark-times2',
          [{name: 'timings', color: 'blue', data: numba_benchmark_times.slice(1, 4)}],
          numba_sections.slice(1, 4),
          'execution time (secs)',
          function () { return this.value + 's'; },
          'dark',
          false);
        create_bar_chart(
          'numba-benchmark-speedup2',
          [{name: 'speedup', color: 'red', data: numba_benchmark_speedups.slice(1, 4)}],
          numba_sections.slice(1, 4),
          'speedup factor',
          function () { return this.value; },
          'dark',
          false);
      });
    </script>

  </body>
</html>
